[
  {
    "objectID": "Best_practice_R.html",
    "href": "Best_practice_R.html",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "",
    "text": "This document outlines coding best practices in R for biometricians and quantitative biologists within ADF&G, with the hope that a common framework will facilitate collaboration and code review. The main objective is to make code easily readable, understandable, and reproducible. A second objective is to give all ADF&G staff members a common starting point while learning to use R to achieve their job responsibilities. Coding best practices work in tandem with the Department’s operational planning and reporting polices to facilitate reproducible research."
  },
  {
    "objectID": "Best_practice_R.html#conventions-used-in-this-document",
    "href": "Best_practice_R.html#conventions-used-in-this-document",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "Conventions used in this document",
    "text": "Conventions used in this document\nWhen point and click sequences are referenced in this text, the sequence will be enclosed in “quotations”. Button names will be shown in italic. Button names in the point and click sequence will be separated by the greater than symbol (&gt;). Any actions required will be described using italics enclosed in parentheses, such as (italics enclosed in parentheses). For example, reference the following point and click sequence: “Button name &gt; Button name &gt; (Required action described)”. Keystrokes will be described with regular font enclosed in quotations, e.g., “Control+Shift+R”.\nExample R scripts will be shown in code blocks:\n\n#example\nage &lt;- 48\n\nR commands in the text below will be shown using inline code blocks (e.g. &lt;-)."
  },
  {
    "objectID": "Best_practice_R.html#r-and-rstudio-best-practices",
    "href": "Best_practice_R.html#r-and-rstudio-best-practices",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "R and Rstudio Best Practices ",
    "text": "R and Rstudio Best Practices \n\nUse RStudio Projects:\n\nTo create a new RStudio project: “File &gt; New Project… &gt; New Directory &gt; New Project &gt; (Provide a Directory name and location) &gt; Create Project”.\n\nChecking the box next to “Create a git repository” will initialize a git repository in the project directory.\nChecking the box next to “Use renv with this project” will create a package environment for your project, which will protect your analysis from package updates and retirements.\n\nRStudio projects make file paths within the project relative to the location of the RStudio project file (.Rproj). This provides stability because relative file locations (e.g., \"./raw data.xlsx\") will not break if the project folder is moved to a new location.\n\nThis approach is more stable than absolute paths created using setwd(). Use of setwd() should be reserved for sharing small pieces of code in situations where the code will not be further developed.\nRefer to the RStudio tips and tricks section below to learn more about file paths.\n\n\nDon’t save your work environment:\n\nTo ensure your work environment is never saved when exiting RStudio, go to “Tools &gt; Global Options &gt; Save workspace to .RData on exit, (Change selection to ‘Never’)”.\nThis practice ensures programming errors are not masked by orphaned objects in your workspace.\nIf the analyses are lengthy, complex, or time consuming, the deliberate practice of saving specific output files, which can be sourced later, is more stable.\n\nUse a consistent folder structure within each RStudio project: \n\nProject/Analysis name\n\nscripts – This folder contains the R scripts used to perform fisheries analysis.\ndata – This folder contains any data sets used in the project or analysis and any code required to prepare the data for analysis. \n\nThe raw data file for the project should be a read-only file (i.e. never adjust the contents of a raw data file). If changes are required, they should be done via code prior to the analysis. If errors are located, they should be communicated back to the database manager for correction. \nIf data are confidential, write a comment in the script explaining how to call the data, where it is stored on an ADF&G server, or whom to contact. \n\nreports – This folder contains FDS reports, operational plans, and any other documents associated with the analysis.\nREADME file – This file stored in the main project directory can be very helpful for orienting a new user.\nYou can add to this basic structure with additional folders such as: functions (R scripts containing functions, which can be sourced when needed in other scripts), output (summary tables, .csv files, Excel files, JAGS posteriors, .RData files, simulation objects, figures, etc.), R Markdown (R Markdown files and outputs), Quarto (Quarto files and outputs), literature (references that are pertinent to the project), and models (statistical model scripts).\n\nMultiple year analyses are generally set up such that there is a separate folder for each year, within which resides the above folder structure (e.g., 2019 folder contains scripts, data, and reports folders).\nThis practice helps to create a common framework to facilitate collaboration, code review, and the reproducibility of projects.\n\n\n\n\n\n\n\n\n\n\n\n\n\n(a) Folder structure when project data is analyzed at once.\n\n\n\n\n\n\n\n\n\n\n\n\n\n(b) Folder structure for separate, annual analyses of each year’s data.\n\n\n\n\n\n\n\nFigure 1: Typical folder structures for ADF&G fisheries analyses.\n\n\n\n\nUse informative headers:\n\nFor better understanding among multiple staff (current and future) and long-term maintenance of analyses, each script should begin with a header that includes at least the following information:\n\nSynopsis of what the code does and which project uses the code pertains\nAuthor\nDate of creation\nOther information a new analyst might find helpful: required packages, parameter names/descriptions, major modification history, dependencies, etc.\n\nRefer to the RStudio tips and tricks section below to learn about using snippets to create informative headers.\n\n\n\n# Find the most common words and word pairs in the DSF Gotham Culture survey results.\n\n# Author: Adam Reimer\n# Version: 2023-05-05\n\n# Packages\npacks &lt;- c(\"tidyverse\", \"stringr\", \"tidytext\", \"textdata\", \"ggraph\")\nlapply(packs, require, character.only = TRUE)\n  \n# Note: The data associated with the project is stored outside of this repository to protect employee privacy.\n\n# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\n\n\nUse a standard template for your script:\n\nFollowing a general coding template will help us all read eachother’s code:\n\nHeader\nRequired packages\nRead data/Clean data\nAnalysis\nWrite/Save output figures and tables\n\nRefer to the RStudio tips and tricks section below to learn about snippets to create a standard template and about using outlines to organize your R script.\n\nHave a naming convention for local variables, global variables, constants, and functions:\n\nKeep names short but descriptive. Meaningful and understandable variable and function names help collaborators differentiate items in the coding environment. In general, variable names should be nouns and function names should be verbs.\nThe best naming convention will vary depending on the application. The most important thing is to be consistent within each script and/or project. On large projects, a glossary of parameter names can help keep the naming convention understandable.\nRename/reformat columns, as needed, immediately after importing data.\nDo not use the same name for multiple purposes. For example, variables with the same name in global and local environments can lead to confusing results.\nAvoid numbers in variable names unless they are informative.\n\nE.g., length500 for a variable that contains the number of fish greater than 500 mm in length is informative.\nIncremental names are not informative (e.g., using S1, S2, and S3 as variables containing the number of fish greater than 300 mm, 400 mm, and 500 mm). If incremental names are used, their meaning should be described in comments.\n\nUse consistent parameter names in the code and the methods of the associated report.\nRefer to the RStudio tips and tricks section below to learn about the clean_names() function and a tip about capital letters in object names.\n\nIndentation and whitespace:\n\nProper indentation and judicious use of whitespace (e.g., spaces between sections) are very important in enhancing the readability of the code.\nBe consistent throughout the entire script.\nRefer to the RStudio tips and tricks section below to learn tips for including whitespace, see an example of having proper indentation and a judicious use of whitespace, and to learn a tip about reindenting or reformatting code.\n\nCode should be well documented:\n\nCommenting makes your code more understandable.\nComments should be brief, relevant, and used conservatively within the script.\nExamples of places to comment code:\n\nAdding links to the origin of copied code and/or to credit the original author\nExplaining a complex piece of code\nStating obscure packages used in the R script and explaining the functionality they provide\nExplaining what a block of code or what each step of a pipe does\nAdding details about units, precision, or the treatment of null values\n\nFor example: Instead of naming a variable catch_kg, make a comment at the beginning of the script that catch is in kg unless otherwise stated, and then name the variable catch.\n\nTo document changes from previous years\nDocument major updates and issues\n\nThe simplest way to document major updates is to include a modification history in the header (e.g., May 2022: changed the statistical analysis to consider year).\nGit/GitHub is a great tool to track updates, note future code improvements, and report issues. See ADFG-DSF/Git_book: A Quarto Book describing best practices for Git use at ADF&G (github.com) for more guidance on using GitHub.\n\n\n\nWrite functions for repetitive tasks:\n\nWhenever possible, write universal functions for small discrete tasks.\n\nIf you have many functions, place them all into one script and source that script in your main code.\nAn extension of this practice is to write utility scripts for larger discrete tasks and then source those scripts in your main code.\n\nThis practice reduces the clutter of the script containing the main analysis so that the main code is easier to follow.\n\nFormat dates using the international date/time standard format (ISO 8601):\n\nDates regularly cause errors. Format all date columns into the international standard format (ISO 8601), which is yyyy-mm-dd, at the beginning of a script to avoid problems later in the analysis.\n\nUse Quarto or R Markdown:\n\nWhen appropriate, use Quarto or R Markdown to generate output documents in Word, PDF, and html formats. Using Quarto or R Markdown allows you to produce high-quality, self-contained output documents directly from code, reducing the likelihood of copy and paste or version errors. Using Quarto or R Markdown is also efficient since you can easily regenerate the entire output following a data update or modification of the code.\nTo create a new Quarto document: “File &gt; New File &gt; Quarto Document… &gt; Document or Presentation or Interactive &gt; (Pick the type of document/presentation to create and type in a Title for the document/presentation; Pick the Engine and Editor as well if need be) &gt; Create”.\nTo create a new R Markdown document: “File &gt; New File &gt; R Markdown… &gt; Document or Presentation or Shiny or From Template &gt; (Pick the type of document/presentation to create, type in a Title for the document/presentation, and check or uncheck box about using current date when rendering document; Or pick the template to use) &gt; OK”."
  },
  {
    "objectID": "Best_practice_R.html#rstudio-tips-and-tricks",
    "href": "Best_practice_R.html#rstudio-tips-and-tricks",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "RStudio tips and tricks",
    "text": "RStudio tips and tricks\n\nRStudio can provide a script outline with navigation\n\nInsert section names such as Read data or Format data using the keyboard shortcut “Control+Shift+R”. These names will appear in your script as a comment with a separator following the name.\n\nSection names can also be typed in using at least one hash sign, then the section name, and then at least 4 dashes or equal signs. For example, # Load data ---- or ## Format data ==== would both create a section name.\nYou can create subsections by preceding your section name with * or sub-subsections by preceding your section name with **.\n\nSection names are visible in an outline. This outline can be accessed by clicking the button with 5 horizontal lines at the top right corner of the source pane in RStudio. Section names in the outline can be clicked on to navigate through a lengthy piece of code.\n\nRStudio snippets can be used to insert a standard header and code template in a new R script.\n\nTo create a header/code template snippet, go to “Tools &gt; Edit Code Snippets… &gt; (Paste the following rscript snippet at the bottom of the pop-up) &gt; Save”.\n\n\nsnippet rscript\n    # ${1:Description}\n\n    # Author: ${2:Name}\n    # Version: `r Sys.Date()`\n\n    # Packages\n    packs &lt;- c(\"${3:Packages}\")\n    lapply(packs, require, character.only = TRUE)\n\n    # Parameters\n\n    # &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\n\n    # Read data ---------------------------------------------------------------\n    ${4:code}\n\n    #  * Format data ----------------------------------------------------------\n\n    # Analysis ----------------------------------------------------------------\n\n    # Results -----------------------------------------------------------------\n\n\nTo use the rscript snippet, type rscript slowly in a blank R script and hit “Enter” when the command auto-completes. A standard header and code template will be added to your script with the cursor placed where the code description should be entered (see Figure 2). After you have entered an appropriate description, pressing the “Tab” key will take the cursor to the area where the author’s name should be entered. A third “Tab” keystroke will take the cursor to the area where packages can be specified, and a forth “Tab” keystroke will take the cursor to the section where you can begin writing your code. Notice the snippet creates section names and the associated preliminary outline.\n\n\n\n\n\n\n\n\nFigure 2: The output of the rscript snippet in a blank R script.\n\n\n\n\nYou can specify package names (e.g. dplyr::rename vs. rename) when using uncommon functions to make the dependency clear and/or avoid conflicts between packages.\nUse pipes (%&gt;% or |&gt;) to chain together multiple, related operations where the intermediate steps are of little interest. Note that the piping operator %&gt;% requires the dplyr package to be loaded, whereas the native piping operator |&gt; requires no packages to be loaded.\nThe clean_names() function in the janitor package is an easy way to rename all columns consistently.\nObject names in R are case specific. Use capital letters sparingly if at all. It can be difficult to remember arbitrary capitalization in variable and function names.\nUse &lt;- (not =) for object assignments. This helps distinguish object assignments from passing values/objects to function arguments. Make sure to use = (not &lt;-) in function arguments to avoid making “accidental” objects.\nUse TRUE and FALSE, not T or F (the latter can be reassigned, the former cannot).\nPlace spaces around all binary operators (=, +, -, &lt;-, etc.). Do not place a space before a comma, but always place one after a comma. Place a space before a left parenthesis or left curly bracket, except in a function call. There should be a hard return after pipe operators.\n\n# An example of R script spacing\nhuman_age &lt;- function(dog_age) {\n  # args: dog_age = the age of a medium-sized dog in years\n  # return: the equivalent human age (in years) for the dog\n  # from https://www.akc.org/expert-advice/health/how-to-calculate-dog-years-to-human-years/\n\n  stopifnot(dog_age &gt;= 0, dog_age &lt;= 20)\n\n  output &lt;- \n    if(dog_age &lt;= 2) {\n      dog_age * 12\n    } else {\n      24 + (dog_age - 2) * 5\n    }\n\n  output\n}\n\n# An example of hard returns in a pipe sequence\ndata %&gt;%\n  mutate(...) %&gt;%\n  ggplot(...)\n\nRStudio can automatically reformat your code. Go to “Code &gt; Reformat Code”. The keystroke shortcut is “Ctrl+Shift+A”.\nThe autocomplete functionality in RStudio is a great way to avoid misspelling functions, data objects, and file paths.\nR abides by the Unix standard of using forward slashes (/) to navigate directories, while Windows systems use backward slashes (\\). R has trouble parsing character strings with a single backward slash. So if you are using a Windows pathway in an R object, one option is to convert backward slashes to forward slashes (e.g., change read.csv(\".\\data.csv\") to read.csv(\"./data.csv\").\nWhen typing file paths, \"/\" refers to your root directory (e.g., C drive if working locally on a Windows machine), \"./\" refers to your current working directory (location of your .Rproj file), \"../\" refers to the parent directory, \"../../\" to the grandparent, and so on. The here package is an option to simplify relative file paths.\nYou can comment out multiple lines of code in RStudio by highlighting and pressing “Ctrl+Shift+C”."
  },
  {
    "objectID": "Best_practice_R.html#resources",
    "href": "Best_practice_R.html#resources",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "Resources",
    "text": "Resources\nAlthough this document was based on recommendations from ADF&G employees, many of the recommendations were summarized from outside resources including:\n\nhttps://style.tidyverse.org/\nhttps://www.geeksforgeeks.org/coding-standards-and-guidelines/\nhttps://github.com/Kristories/awesome-guidelines\nhttps://google.github.io/styleguide/Rguide.xml"
  }
]