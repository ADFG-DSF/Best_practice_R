[
  {
    "objectID": "Best_practice_R.html",
    "href": "Best_practice_R.html",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "",
    "text": "This document outlines coding best practices in R for biometricians and quantitative biologists within ADF&G, with the hope that a common framework will facilitate collaboration and code review. The main objective is to make code easily readable, understandable, and reproducible. A second objective is to give all ADF&G staff members a common starting point while learning to use R to achieve their job responsibilities. Coding best practices work in tandem with the Department’s operational planning and reporting polices to facilitate reproducible research."
  },
  {
    "objectID": "Best_practice_R.html#conventions-used-in-this-document",
    "href": "Best_practice_R.html#conventions-used-in-this-document",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "Conventions used in this document",
    "text": "Conventions used in this document\nWhen point and click sequences are referenced in this text the sequence will be enclosed in “quotations”, button names will be shown in italic, button names in the series will be separated by and the greater than symbol (&gt;) and any actions required will be described using (italics enclosed in parenthesis). Keystrokes will be described with regular font enclosed in quotations.\nExample R scripts will he shown in code blocks:\n\n#example\nage &lt;- 48\n\nR commands which are referenced in the text will be shown using inline code blocks (e.g. &lt;-)."
  },
  {
    "objectID": "Best_practice_R.html#r-and-rstudio-best-practices",
    "href": "Best_practice_R.html#r-and-rstudio-best-practices",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "R and Rstudio Best Practices ",
    "text": "R and Rstudio Best Practices \n\nUse RStudio Projects:\n\nTo create a new RStudio project: “File &gt; New Project… &gt; New Directory &gt; New Project &gt; (provide a name and location) &gt; create project”.\n\nChecking the box next to “create git repository” will initialize a git repository in the project directory.\nChecking the box next to “Use renv with this project” will create a package environment for your project which will protect your analysis from package updates and retirements.\n\nRStudio projects make file paths within the project relative to the location of the RStudio project file (.Rproj). This provides stability because relative file locations (\".\\\\raw data.xlsx\") will not break if the project folder is moved to a new location.\n\nThis approach is more stable than absolute paths created in the setwd(). Use of setwd() should be reserved for sharing small pieces of code in situations where the code will not be further developed.\n\n\nDon’t save your work environment: In RStudio, go to “Tools &gt; Global Options &gt; Save workspace to .Rdata on exit, (change selection to ‘Never’)”. This practice ensures programming errors are not masked by orphaned objects in your workspace. If the analyses are lengthy, complex or time consuming the deliberate practice of saving specific output files, which can be sourced later, is more stable.\nUse a consistent folder structure within each RStudio project: \n\nProject/Analysis name\n\nscripts – R scripts for performing fisheries analysis\nfunctions – R scripts containing functions can be sourced when needed in other scripts \ndata – any data sets used in the project or analysis \n\nraw data – raw data is read only (i.e. never adjust the contents of a raw data file). If changes are required they should be done via code prior to the analysis. If errors are located they should communicated back to the database manager for correction. \nIf data are confidential, write a comment in the script explaining how to call the data (e.g. OceanAK), where it is stored on an ADF&G server, or whom to contact. \n\nreports – FDS reports, operational plans and other documents associated with the analysis \noutput – Summary tables, csv files, excel files, jags posteriors, simulation objects, figures. \n\nYou can add to this basic structure with additional folders such as: rmarkdown (markdown files and outputs), literature (references that are pertinent to the project), models (statistical model scripts), data processing/management. \nIn addition, a README file stored in the main project directory can be very helpful for orienting a new user.\nMultiple year analyses are generally set up such that there is a separate folder for each year within which resides specific files with relevance for each year.\n\n\n\n\n\n\n\n\n\n(a) Folder structure when project data is analyzed at once.\n\n\n\n\n\n\n\n\n\n(b) Folder structure for separate, annual analyses of each year’s data.\n\n\n\n\nFigure 1: Typical folder structures for ADF&G fisheries analyses.\n\n\n\nUse informative headers: For better understanding among multiple staff (current and future) and long-term maintenance of analyses, each script should begin with a header that includes at least the following information:\n\nSynopsis of what the code does\nAuthor\nDate of creation\nRequired packages\nOther information a new analyst might find helpful: e.g. parameter names/descriptions, major modification history, dependencies.\n\n\n\n# Find the most common words and word pairs in the DSF Gotham Culture survey results.\n\n# Author: Adam Reimer\n# Version: 2023-05-05\n\n# Packages\npacks &lt;- c(\"tidyverse\", \"stringr\", \"tidytext\", \"textdata\", \"ggraph\")\nlapply(packs, require, character.only = TRUE)\n  \n# Note: The data associated with the project is stored outside of this repository to protect employee privacy.\n\n# &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\n\n\nUse a standard template for your script: Following a general code template will help us all read each others code:\n\nHeader\nRead/Clean data inputs\nAnalysis\nWrite/Save output figures and tables\n\nHave a naming convention for local variables, global variables, constants, and functions:\n\nKeep names short but descriptive. Meaningful and understandable variables and function names help collaborators differentiate items in the coding environment. In general, variable names should be nouns and function names should be verbs.\nThe best naming convention will vary depending on the application. The most important thing is to be consistent within each script and/or project. On large projects, a glossary of parameter names can help keep the naming convention understandable.\nRename/reformat columns, as needed, immediately after importing a dataset.\nDo not use the same name for multiple purposes. For example, variables with the same name in global and local environments can lead to confusing results.\nAvoid numbers in variable names unless they are informative.\n\nE.g., length500 for a variable which contains the number of fish greater than 500mm in length is informative.\nIncremental names are not informative (e.g., what is contained in objects named “S1”, “S2”, and “S3”). If incremental names are used, their meaning should be described in comments.\n\nUse consistent parameter names in the code and the methods of the associated report.\n\nIndentation and whitespace: Proper indentation and judicious use of whitespace (e.g., spaces between sections) are very important in enhancing the readability of the code. Be consistent throughout the entire script.\nCode should be well documented:\n\nCommenting makes your code more understandable. Comments should be brief, relevant, and used conservatively within the script. Examples of places to comment code:\n\nAdding links to the origin of copied code and/or to credit the original author\nExplaining a complex piece of code\nExplaining what a block of code (or each step of a pipe) does\nAdding details about units, precision, or the treatment of null values. For example: instead of naming a variable catch_kg, make a comment at the beginning of the script that catch is in kg, unless otherwise stated, then name the variable catch.\nTo document changes from previous years\n\nDocument major updates and issues.\n\nThe simplest way to document major updates is to include a modification history in the header (e.g., “May 2022: changed the statistical analysis to consider year”).\nGit/GitHub is a great tool to track updates, note future code improvements, and report issues. See ADFG-DSF/Git_book: A Quarto Book describing best practices for Git use at ADF&G (github.com) for more guidance on using GitHub.\n\n\nWrite functions for repetitive tasks: Whenever possible, write universal functions for small discrete tasks. If you have many functions, place them all into one script and source that script into your main code. An extension of this practice is to write utility scripts for larger discrete tasks and source that from your main code.\nFormat dates using the international date/time standard format (ISO 8601), which is yyyy-mm-dd: Dates regularly cause errors. Format all date columns into ISO8601 at the beginning of a script to avoid problems later in the analysis.\nUse Quarto: When appropriate, use Quarto to generate output documents in Word, PDF, and html formats. Using Quarto allows you to produce high-quality, self-contained output document directly from code, reducing the likelihood of copy and paste or version errors. Using Quarto is also efficienct since you can easily regenerate the entire output following a data set update or modification of the code."
  },
  {
    "objectID": "Best_practice_R.html#rstudio-tips-and-tricks",
    "href": "Best_practice_R.html#rstudio-tips-and-tricks",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "RStudio tips and tricks",
    "text": "RStudio tips and tricks\n\nRStudio can provide a script outline with navigation\n\nInsert section names such as Read data or Format data using the keyboard shortcut “Control-Shift-R”. These names will appear in your script as a comment with a separator following the name. Section names are visible as an outline (at top right corner of the source pane in R studio) which can be clicked to navigate through a lengthy piece of code.\nYou can create subsections by preceding your name with * or sub-subsections by preceding your name with * *.\n\nRStudio snippets can be used to insert a standard header and template in a new script. To create a header/template snippet navigate to “Tools &gt; Edit Code Snippets… &gt; (paste the following at the bottom of the pop-up) &gt; Save”.\n\nsnippet rscript\n    # ${1:Description}\n\n    # Author: ${2:Name}\n    # Version: `r Sys.Date()`\n\n    # Packages\n    packs &lt;- c(\"${3:Packages}\")\n    lapply(packs, require, character.only = TRUE)\n\n    # Parameters\n\n    # &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\n\n    # Read data ---------------------------------------------------------------\n    ${4:code}\n\n    #  * Format data ----------------------------------------------------------\n\n    # Analysis ----------------------------------------------------------------\n\n    # Results -----------------------------------------------------------------\n\nTo use the snippet type rscript slowly in a blank R script and hit “Enter” when the command auto-completes. A standard header/code template will be added to your script with the cursor placed where the code description should be entered (see Figure 2). After you have entered an appropriate description pressing the “Tab” key will take the cursor to the area where the analyst name should be entered, a third “Tab” keystroke will take the cursor to the area where packages can be specified and a forth “Tab” keystroke will take the cursor to the section where you can begin writing your code. Notice the snippet creates section names and the associated preliminary outline.\n\n\n\n\nFigure 2: The output of the rscript snippet on a blank R script.\n\n\n\nAdd comments for obscure packages explaining the functionality they provide. You can also specify package names (e.g. dplyr::rename vs. rename) when using uncommon functions to make the dependency clear and/or avoid conflicts between packages.\nUse pipes (%&gt;%) to chain together multiple, related operations where the intermediate steps are of little interest.\nThe clean_names() function in the janitor package is an easy way to rename all columns consistently.\nObject names in R are case specific. Use capital letters sparingly if at all. It can be difficult to remember arbitrary capitalization in variable and function names.\nUse &lt;- (not =) for assignments. This helps distinguish object assignments from passing values/objects to function arguments.\nUse TRUE and FALSE, not T or F (the latter can be reassigned, the former cannot).\nPlace spaces around all binary operators (=, +, -, &lt;-, etc.). Do not place a space before a comma, but always place one after a comma. Place a space before left parenthesis or curly brackets, except in a function call. There should be a hard return after pipe operators.\n\n# An example of R script spacing\nhuman_age &lt;- function(dog_age){\n  #args: dog_age = The age of a medium sized dog in years\n  #return: The equivalent human age (in years) for the dog\n  # from https://www.akc.org/expert-advice/health/how-to-calculate-dog-years-to-human-years/\n\n  stopifnot(dog_age &gt;= 0, dog_age &lt;= 20)\n\n  output &lt;- \n    if(dog_age &lt;= 2) {\n      dog_age * 12\n    } else {\n      24 + (dog_age - 2) * 5\n    }\n\n  output\n}\n\n# An example of hard returns in a pipe sequence.\ndata %&gt;%\n  mutate(...) %&gt;%\n  ggplot(...)\n\nRStudio can automatically re-indent/format your code “Code &gt; Reformat Code”. The keystroke shortcut is “Ctrl + Shift + A”\nThe auto-complete functionality in RStudio is a great way to avoid misspelling functions, data objects, and file paths.\nR abides by the Unix standard of using forward slashes (/) to navigate directories while Windows systems use backward slashes (\\). R has trouble parsing character strings with a single backward slash; if you are using a Windows pathway in an R object one option is to convert backward slashes to forward slashes (e.g., change read.csv(\".\\data.csv\") to read.csv(\"./data.csv\").\nWhen typing file paths, \"/\" refers to your root directory (e.g. C drive if working locally on a windows machine), \"./\" refers to your current working directory (location of your .Rproj file), \"../\" refers to the parent directory, \"../../\" to the grandparent, and so on. The here package is an option to simplify relative files paths.\nYou can comment out multiple lines of code in RStudio by highlighting and pressing “Ctrl + Shift + C”."
  },
  {
    "objectID": "Best_practice_R.html#resources",
    "href": "Best_practice_R.html#resources",
    "title": "R Best Practices for ADF&G Biometricans",
    "section": "Resources",
    "text": "Resources\nAlthough this document was based on recommendations from ADF&G employees, many of the recommendations were summarized from outside resources including:\n\nhttps://style.tidyverse.org/\nhttps://www.geeksforgeeks.org/coding-standards-and-guidelines/\nhttps://github.com/Kristories/awesome-guidelines\nhttps://google.github.io/styleguide/Rguide.xml"
  }
]